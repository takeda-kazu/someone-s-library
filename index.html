<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="å€‹äººã®æœ¬æ£šç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - èª­æ›¸è¨˜éŒ²ã¨æ„Ÿæƒ³ã‚’ä¿å­˜ãƒ»å…±æœ‰"
    />
    <meta name="theme-color" content="#000000" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://udify.app https://*.udify.app https://googletagmanager.com https://www.googletagmanager.com https://analytics.google.com https://api.github.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: http:; font-src 'self' data:; connect-src 'self' https://www.gstatic.com https://firebasestorage.googleapis.com https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://udify.app https://*.udify.app https://googletagmanager.com https://www.googletagmanager.com https://analytics.google.com https://api.github.com; frame-src 'self' https://udify.app https://*.udify.app; media-src 'self' https://udify.app https://*.udify.app;">
    <title>ã€‡ã€‡æœ¬æ£š - Library Watch</title>
    <link rel="stylesheet" href="styles.css" />

    <!-- Firebase SDK -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
      import {
        getFirestore,
        collection,
        doc,
        addDoc,
        setDoc,
        updateDoc,
        deleteDoc,
        getDocs,
        query,
        orderBy,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBs8q4LIEnYpqk_PzaJwZO7I7C9gWu6MIk",
        authDomain: "library-6632c.firebaseapp.com",
        projectId: "library-6632c",
        storageBucket: "library-6632c.firebasestorage.app",
        messagingSenderId: "475019124517",
        appId: "1:475019124517:web:69e3e6d5d81467a61944cc",
        measurementId: "G-8GWPSS67D1",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦è¨­å®š
      window.firebaseApp = app;
      window.firebaseAuth = auth;
      window.firebaseDb = db;

      // Firestoreé–¢æ•°ã‚‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
      window.firestore = {
        collection,
        doc,
        addDoc,
        setDoc,
        updateDoc,
        deleteDoc,
        getDocs,
        getDoc,
        query,
        orderBy,
      };

      // Firebase Authé–¢æ•°ã‚‚ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
      window.firebaseAuthFunctions = {
        signInWithEmailAndPassword,
        signOut,
        onAuthStateChanged,
      };

      console.log("Firebase initialized successfully");
    </script>

    <script src="books-data.js"></script>
    <script src="app.js"></script>
  </head>
  <body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¢ãƒ—ãƒªã®ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <header id="app-header" role="banner">
      <div class="header-content">
        <h1 id="app-title">
          <span class="visually-hidden">ç§ã®</span>
          ã€‡ã€‡æœ¬æ£š
        </h1>
        <!-- ç®¡ç†ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
        <nav class="admin-controls" aria-label="ç®¡ç†ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ">
          <button
            id="admin-mode-btn"
            class="admin-button"
            aria-label="ç®¡ç†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ"
            type="button"
          >
            ç®¡ç†
          </button>
          <button
            id="normal-mode-btn"
            class="admin-button"
            style="display: none"
            aria-label="é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ"
            type="button"
          >
            é€šå¸¸
          </button>
        </nav>
      </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <main id="main-content" role="main">
      <!-- SC1: ä¸€è¦§ç”»é¢ -->
      <section
        id="screen-list"
        class="screen"
        aria-labelledby="book-list-heading"
      >
        <h2 id="book-list-heading" class="visually-hidden">æœ¬ã®ä¸€è¦§</h2>

        <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ï¼ˆç®¡ç†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
        <div
          id="search-controls"
          class="search-controls"
          style="display: none"
          role="search"
          aria-label="æœ¬ã‚’æ¤œç´¢"
        >
          <label for="search-input" class="visually-hidden">æœ¬ã‚’æ¤œç´¢</label>
          <input
            type="search"
            id="search-input"
            placeholder="æœ¬ã‚’æ¤œç´¢..."
            class="search-input"
            aria-describedby="search-hint"
          />
          <span id="search-hint" class="visually-hidden"
            >ã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯è‘—è€…åã§æ¤œç´¢ã§ãã¾ã™</span
          >

          <label for="author-filter" class="visually-hidden"
            >è‘—è€…ã§çµã‚Šè¾¼ã¿</label
          >
          <select
            id="author-filter"
            class="author-filter"
            aria-label="è‘—è€…ã§çµã‚Šè¾¼ã¿"
          >
            <option value="">ã™ã¹ã¦ã®è‘—è€…</option>
          </select>

          <button
            id="add-book-btn"
            class="add-book-button"
            type="button"
            aria-label="æ–°ã—ã„æœ¬ã‚’è¿½åŠ "
          >
            <span aria-hidden="true">+</span> æ–°è¦è¿½åŠ 
          </button>
        </div>

        <div
          id="book-list"
          role="list"
          aria-live="polite"
          aria-atomic="false"
        ></div>
      </section>

      <!-- SC2: è©³ç´°ç”»é¢ -->
      <section
        id="screen-detail"
        class="screen"
        style="display: none"
        aria-labelledby="detail-heading"
      >
        <button
          id="back-btn"
          class="back-button"
          type="button"
          aria-label="ä¸€è¦§ã«æˆ»ã‚‹"
        >
          <span aria-hidden="true">â†</span> æˆ»ã‚‹
        </button>
        <div id="book-detail-content" role="article">
          <!-- ã“ã“ã«æœ¬ã®è©³ç´°ãŒå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
      </section>

      <!-- SC3: è¿½åŠ ãƒ»ç·¨é›†ç”»é¢ï¼ˆç®¡ç†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿è¡¨ç¤ºï¼‰ -->
      <section
        id="screen-edit"
        class="screen"
        style="display: none"
        aria-labelledby="edit-heading"
      >
        <button
          id="back-edit-btn"
          class="back-button"
          type="button"
          aria-label="ä¸€è¦§ã«æˆ»ã‚‹"
        >
          <span aria-hidden="true">â†</span> ä¸€è¦§ã«æˆ»ã‚‹
        </button>
        <div id="book-edit-content">
          <!-- ã“ã“ã«æœ¬ã®è¿½åŠ ãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ãŒå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
      </section>
    </main>

    <!-- èªè¨¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div
      id="auth-modal"
      class="modal"
      style="display: none"
      role="dialog"
      aria-modal="true"
      aria-labelledby="auth-modal-title"
    >
      <div class="modal-overlay" aria-hidden="true"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="auth-modal-title">ç®¡ç†ãƒ¢ãƒ¼ãƒ‰èªè¨¼</h2>
          <button
            id="close-auth-modal-x"
            class="close-x"
            type="button"
            aria-label="èªè¨¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹"
          >
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
        <form class="auth-form" onsubmit="return false;">
          <label for="auth-email" class="visually-hidden">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
          <input
            type="email"
            id="auth-email"
            placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
            class="auth-input"
            required
            autocomplete="email"
            aria-required="true"
          />

          <label for="auth-password" class="visually-hidden">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input
            type="password"
            id="auth-password"
            placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
            class="auth-input"
            required
            autocomplete="current-password"
            aria-required="true"
          />

          <button
            id="auth-login-btn"
            class="auth-button"
            type="submit"
            aria-label="ãƒ­ã‚°ã‚¤ãƒ³"
          >
            ãƒ­ã‚°ã‚¤ãƒ³
          </button>
        </form>
        <div class="modal-buttons">
          <button id="close-auth-modal-btn" class="close-button" type="button">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </button>
        </div>
      </div>
    </div>

    <!-- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div
      id="prompt-modal"
      class="modal"
      style="display: none"
      role="dialog"
      aria-modal="true"
      aria-labelledby="prompt-modal-title"
    >
      <div class="modal-overlay" aria-hidden="true"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="prompt-modal-title">ä¸Šå¸ã¨å¯¾è©±ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h2>
          <button
            id="close-modal-x"
            class="close-x"
            type="button"
            aria-label="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹"
          >
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
        <label for="prompt-text" class="visually-hidden"
          >ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆ</label
        >
        <textarea
          id="prompt-text"
          class="prompt-textarea"
          readonly
          aria-label="ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆ"
          aria-describedby="prompt-description"
        ></textarea>
        <p id="prompt-description" class="visually-hidden">
          ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦AIãƒãƒ£ãƒƒãƒˆã§ä½¿ç”¨ã§ãã¾ã™
        </p>
        <div class="modal-buttons">
          <button
            id="copy-btn"
            class="copy-button"
            type="button"
            aria-label="ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼"
          >
            <span aria-hidden="true">ğŸ“‹</span> ã‚³ãƒ”ãƒ¼
          </button>
          <button id="close-modal-btn" class="close-button" type="button">
            é–‰ã˜ã‚‹
          </button>
        </div>
      </div>
    </div>

    <!-- ã‚³ãƒ”ãƒ¼æˆåŠŸãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div
      id="copy-success-modal"
      class="modal copy-success-modal"
      style="display: none"
      role="alert"
      aria-live="assertive"
      aria-labelledby="copy-success-title"
    >
      <div class="modal-overlay" aria-hidden="true"></div>
      <div class="modal-content copy-success-content">
        <div class="modal-header copy-success-header">
          <h2 id="copy-success-title">
            <span aria-hidden="true">âœ¨</span> ã‚³ãƒ”ãƒ¼å®Œäº†
          </h2>
          <button
            id="close-copy-success-x"
            class="close-x"
            type="button"
            aria-label="é€šçŸ¥ã‚’é–‰ã˜ã‚‹"
          >
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
        <div class="copy-success-message">
          <p>ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚AIã«èª­ã¿è¾¼ã¾ã›ã¦å¯¾è©±ã—ã¾ã—ã‚‡ã†</p>
        </div>
        <div class="modal-buttons">
          <button
            id="close-copy-success-btn"
            class="close-button"
            type="button"
          >
            é–‰ã˜ã‚‹
          </button>
        </div>
      </div>
    </div>

    <!-- é–²è¦§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div
      id="view-password-modal"
      class="modal"
      style="display: none"
      role="dialog"
      aria-modal="true"
      aria-labelledby="view-password-title"
    >
      <div class="modal-overlay" aria-hidden="true"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="view-password-title">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
        </div>
        <form
          class="auth-form"
          id="view-password-form"
          onsubmit="return false;"
        >
          <label for="view-password-input" class="visually-hidden"
            >ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label
          >
          <input
            type="password"
            id="view-password-input"
            placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
            class="auth-input"
            required
            autocomplete="off"
            aria-required="true"
          />
          <div
            id="view-password-error"
            style="color: #f5576c; margin-top: 0.5rem; display: none"
          >
            ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“
          </div>
          <button
            id="view-password-btn"
            class="auth-button"
            type="submit"
            aria-label="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèª"
          >
            ç¢ºèª
          </button>
        </form>
      </div>
    </div>

    <!-- AIãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div
      id="chat-modal"
      class="modal chat-modal"
      style="display: none"
      role="dialog"
      aria-modal="true"
      aria-labelledby="chat-modal-title"
    >
      <div class="modal-overlay" aria-hidden="true"></div>
      <div class="modal-content chat-modal-content">
        <div class="modal-header">
          <div>
            <h2 id="chat-modal-title" style="margin-bottom: 0.25rem; font-size: 1.25rem;">AIèª­æ›¸ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</h2>
            <p id="chat-modal-book-title" style="font-size: 0.9rem; opacity: 0.9; font-weight: normal;">æœ¬ã‚’é¸æŠä¸­...</p>
          </div>
          <button
            id="close-chat-modal-x"
            class="close-x"
            type="button"
            aria-label="ãƒãƒ£ãƒƒãƒˆã‚’é–‰ã˜ã‚‹"
          >
            <span aria-hidden="true">Ã—</span>
          </button>
        </div>
        <div class="chat-container">
          <iframe
            id="dify-chatbot-iframe"
            src=""
            style="width: 100%; height: 100%; border: none"
            frameborder="0"
            allow="microphone"
          >
          </iframe>
        </div>
        <div class="modal-footer">
           <button id="chat-copy-info-btn" class="copy-button" type="button" style="margin-right: auto;">
            <span aria-hidden="true">ğŸ“‹</span> æœ¬ã®æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼
          </button>
          <button id="close-chat-modal-btn" class="close-button" type="button">
            é–‰ã˜ã‚‹
          </button>
        </div>
      </div>
    </div>

    <!-- Status messages for screen reader announcements -->
    <div
      role="status"
      aria-live="polite"
      aria-atomic="true"
      class="visually-hidden"
      id="status-message"
    ></div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
    <div
      id="loading-indicator"
      class="loading-overlay"
      style="display: none"
      role="status"
      aria-live="polite"
    >
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <div class="spinner-ring"></div>
        <p class="loading-text">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    </div>

    <!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div
      id="toast-container"
      class="toast-container"
      aria-live="polite"
      aria-atomic="true"
    ></div>
  </body>
</html>
